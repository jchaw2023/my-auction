# MyAuction é¡¹ç›®éƒ¨ç½²æ–‡æ¡£

## ğŸ“‹ ç›®å½•

- [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
- [åŠŸèƒ½ç‰¹æ€§](#åŠŸèƒ½ç‰¹æ€§)
- [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
- [ç¯å¢ƒè¦æ±‚](#ç¯å¢ƒè¦æ±‚)
- [éƒ¨ç½²æ­¥éª¤](#éƒ¨ç½²æ­¥éª¤)
- [æµ‹è¯•æ­¥éª¤](#æµ‹è¯•æ­¥éª¤)
- [åˆçº¦å‡çº§](#åˆçº¦å‡çº§)
- [ä½¿ç”¨è¯´æ˜](#ä½¿ç”¨è¯´æ˜)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## é¡¹ç›®æ¦‚è¿°

MyAuction æ˜¯ä¸€ä¸ªåŸºäºä»¥å¤ªåŠçš„å»ä¸­å¿ƒåŒ– NFT æ‹å–å¹³å°ï¼Œæ”¯æŒä½¿ç”¨ ETH æˆ– ERC20 ä»£å¸è¿›è¡Œå‡ºä»·ã€‚é¡¹ç›®é‡‡ç”¨é€æ˜ä»£ç†æ¨¡å¼å®ç°åˆçº¦å‡çº§åŠŸèƒ½ï¼Œå¹¶é›†æˆäº† Chainlink ä»·æ ¼é¢„è¨€æœºæ¥å®ç°å¤šå¸ç§å‡ºä»·çš„ç»Ÿä¸€ä»·å€¼æ¯”è¾ƒã€‚

### æ ¸å¿ƒåˆçº¦

1. **MyNFT** - ERC721 NFT åˆçº¦
   - æ”¯æŒ NFT é“¸é€ å’Œç®¡ç†
   - æ”¯æŒè®¾ç½®åŸºç¡€ URI å’Œè‡ªå®šä¹‰ token URI
   - æ”¯æŒæ‰¹é‡é“¸é€ 

2. **MyAuction** (V1) - æ‹å–åˆçº¦åŸºç¡€ç‰ˆæœ¬
   - æ”¯æŒ NFT æ‹å–åˆ›å»º
   - æ”¯æŒ ETH å’Œ ERC20 ä»£å¸å‡ºä»·
   - é›†æˆ Chainlink ä»·æ ¼é¢„è¨€æœº
   - ä½¿ç”¨é€æ˜ä»£ç†æ¨¡å¼å®ç°å¯å‡çº§

3. **MyAuctionV2** - æ‹å–åˆçº¦å‡çº§ç‰ˆæœ¬
   - ç»§æ‰¿ V1 æ‰€æœ‰åŠŸèƒ½
   - æ–°å¢å¹³å°æ‰‹ç»­è´¹åŠŸèƒ½ï¼ˆæ”¯æŒå›ºå®šå’ŒåŠ¨æ€è´¹ç‡ï¼‰
   - æ–°å¢ç´§æ€¥æš‚åœåŠŸèƒ½
   - æ–°å¢æ‹å–ç»Ÿè®¡åŠŸèƒ½
   - æ–°å¢æ‰¹é‡æŸ¥è¯¢åŠŸèƒ½

---

## åŠŸèƒ½ç‰¹æ€§

### 1. NFT æ‹å–åŠŸèƒ½

- âœ… **åˆ›å»ºæ‹å–**: NFT æ‰€æœ‰è€…å¯ä»¥åˆ›å»ºæ‹å–ï¼Œè®¾ç½®èµ·å§‹ä»·æ ¼å’Œæ—¶é—´
- âœ… **å¤šå¸ç§å‡ºä»·**: æ”¯æŒä½¿ç”¨ ETH æˆ–ä»»æ„ ERC20 ä»£å¸å‡ºä»·
- âœ… **ç»Ÿä¸€ä»·å€¼æ¯”è¾ƒ**: é€šè¿‡ Chainlink é¢„è¨€æœºå°†æ‰€æœ‰å‡ºä»·è½¬æ¢ä¸º USD ä»·å€¼è¿›è¡Œæ¯”è¾ƒ
- âœ… **è‡ªåŠ¨é€€æ¬¾**: å½“æœ‰æ›´é«˜å‡ºä»·æ—¶ï¼Œè‡ªåŠ¨é€€è¿˜å‰ä¸€ä¸ªå‡ºä»·è€…çš„èµ„é‡‘
- âœ… **ç»“æŸæ‹å–**: æ‹å–ç»“æŸåï¼ŒNFT è½¬ç§»ç»™æœ€é«˜å‡ºä»·è€…ï¼Œèµ„é‡‘è½¬ç§»ç»™å–å®¶

### 2. åŠ¨æ€æ‰‹ç»­è´¹ç³»ç»Ÿ (V2)

- âœ… **å›ºå®šæ‰‹ç»­è´¹**: å¯è®¾ç½®å›ºå®šçš„å¹³å°æ‰‹ç»­è´¹ï¼ˆåŸºç‚¹ï¼Œ100 = 1%ï¼‰
- âœ… **åŠ¨æ€æ‰‹ç»­è´¹**: æ ¹æ®æ‹å–é‡‘é¢è‡ªåŠ¨è°ƒæ•´æ‰‹ç»­è´¹ç‡
  - é‡‘é¢è¶Šå¤§ï¼Œæ‰‹ç»­è´¹ç‡è¶Šä½
  - æ”¯æŒè‡ªå®šä¹‰æ‰‹ç»­è´¹æ¡£æ¬¡
  - ç¤ºä¾‹è´¹ç‡ï¼š
    - $0 - $1,000: 5%
    - $1,000 - $10,000: 3%
    - $10,000 - $100,000: 1%
    - $100,000+: 0.5%

### 3. åˆçº¦å‡çº§åŠŸèƒ½

- âœ… **é€æ˜ä»£ç†æ¨¡å¼**: ä½¿ç”¨ OpenZeppelin é€æ˜ä»£ç†å®ç°åˆçº¦å‡çº§
- âœ… **å­˜å‚¨å…¼å®¹æ€§**: å‡çº§æ—¶ä¿æŒå­˜å‚¨å¸ƒå±€å…¼å®¹
- âœ… **å¹³æ»‘å‡çº§**: æ”¯æŒåœ¨ä¸å½±å“ç°æœ‰æ•°æ®çš„æƒ…å†µä¸‹å‡çº§åˆçº¦

### 4. ç®¡ç†åŠŸèƒ½ (V2)

- âœ… **ç´§æ€¥æš‚åœ**: åˆçº¦æ‰€æœ‰è€…å¯ä»¥æš‚åœæ‰€æœ‰æ“ä½œ
- âœ… **ä»·æ ¼é¢„è¨€æœºé…ç½®**: æ”¯æŒé…ç½®å¤šä¸ªä»£å¸çš„ä»·æ ¼é¢„è¨€æœº
- âœ… **ç»Ÿè®¡ä¿¡æ¯**: æä¾›æ‹å–å’Œå‡ºä»·çš„ç»Ÿè®¡æ•°æ®

---

## æŠ€æœ¯æ¶æ„

### æŠ€æœ¯æ ˆ

- **Solidity**: 0.8.28
- **Hardhat**: å¼€å‘æ¡†æ¶
- **OpenZeppelin**: åˆçº¦åº“ï¼ˆERC721, ä»£ç†æ¨¡å¼ï¼‰
- **Chainlink**: ä»·æ ¼é¢„è¨€æœº
- **hardhat-deploy**: éƒ¨ç½²ç®¡ç†æ’ä»¶
- **@openzeppelin/hardhat-upgrades**: å‡çº§ç®¡ç†æ’ä»¶

### ç½‘ç»œæ”¯æŒ

- **Hardhat Network**: æœ¬åœ°å¼€å‘ç½‘ç»œ
- **Localhost**: æœ¬åœ°èŠ‚ç‚¹
- **Sepolia**: ä»¥å¤ªåŠæµ‹è¯•ç½‘

### åˆçº¦æ¶æ„

```
MyNFT (ERC721)
    â†“
MyAuction (V1) - é€æ˜ä»£ç†å®ç°
    â†“
MyAuctionV2 - å‡çº§ç‰ˆæœ¬
```

---

## ç¯å¢ƒè¦æ±‚

### å¿…éœ€è½¯ä»¶

- Node.js >= 16.0.0
- npm >= 7.0.0
- Git

### ç¯å¢ƒå˜é‡é…ç½®

é¡¹ç›®ä½¿ç”¨ç¯å¢ƒå˜é‡æ¥ç®¡ç†æ•æ„Ÿä¿¡æ¯ï¼ˆRPC URLã€ç§é’¥ç­‰ï¼‰ï¼Œé¿å…å°†æ•æ„Ÿä¿¡æ¯ç¡¬ç¼–ç åˆ°é…ç½®æ–‡ä»¶ä¸­ã€‚

#### 1. åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶

é¡¹ç›®æ ¹ç›®å½•æä¾›äº† `.env.example` æ–‡ä»¶ä½œä¸ºæ¨¡æ¿ã€‚é¦–æ¬¡ä½¿ç”¨æ—¶ï¼Œéœ€è¦åˆ›å»º `.env` æ–‡ä»¶ï¼š

**Windows:**
```bash
copy .env.example .env
```

**Linux/Mac:**
```bash
cp .env.example .env
```

#### 2. é…ç½®ç¯å¢ƒå˜é‡

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œå¡«å…¥ä½ çš„å®é™…é…ç½®ï¼š

```env
# Hardhat Configuration Environment Variables
# å¤åˆ¶æ­¤æ–‡ä»¶ä¸º .env å¹¶å¡«å…¥å®é™…çš„æ•æ„Ÿä¿¡æ¯

# Sepolia æµ‹è¯•ç½‘ RPC URL
# ç¤ºä¾‹: https://go.getblock.io/YOUR_API_KEY
# æˆ–ä½¿ç”¨å…¬å…± RPC: https://rpc.sepolia.org
SEPOLIA_RPC_URL=https://rpc.sepolia.org

# éƒ¨ç½²è´¦æˆ·çš„ç§é’¥ï¼ˆä¸å¸¦ 0x å‰ç¼€ï¼‰
# è­¦å‘Š: è¯·å‹¿å°†åŒ…å«çœŸå®ç§é’¥çš„ .env æ–‡ä»¶æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ
# ç¤ºä¾‹: YOUR_PRIVATE_KEY_HERE
PRIVATE_KEY=
```

#### 3. ç¯å¢ƒå˜é‡è¯´æ˜

| å˜é‡å | è¯´æ˜ | æ˜¯å¦å¿…éœ€ | é»˜è®¤å€¼ |
|--------|------|---------|--------|
| `SEPOLIA_RPC_URL` | Sepolia æµ‹è¯•ç½‘çš„ RPC ç«¯ç‚¹ URL | å¦ | `https://rpc.sepolia.org` |
| `PRIVATE_KEY` | éƒ¨ç½²è´¦æˆ·çš„ç§é’¥ï¼ˆä¸å¸¦ 0x å‰ç¼€ï¼‰ | æ˜¯ï¼ˆéƒ¨ç½²åˆ° Sepolia æ—¶ï¼‰ | æ—  |

**RPC URL è·å–æ–¹å¼ï¼š**
- **å…¬å…± RPC**: å¯ä»¥ä½¿ç”¨ `https://rpc.sepolia.org`ï¼ˆå…è´¹ï¼Œä½†å¯èƒ½æœ‰é€Ÿç‡é™åˆ¶ï¼‰
- **Infura**: æ³¨å†Œè´¦å·åè·å– API Keyï¼Œæ ¼å¼ï¼š`https://sepolia.infura.io/v3/YOUR_API_KEY`
- **Alchemy**: æ³¨å†Œè´¦å·åè·å– API Keyï¼Œæ ¼å¼ï¼š`https://eth-sepolia.g.alchemy.com/v2/YOUR_API_KEY`
- **GetBlock**: æ³¨å†Œè´¦å·åè·å– API Keyï¼Œæ ¼å¼ï¼š`https://go.getblock.io/YOUR_API_KEY`

**ç§é’¥è¯´æ˜ï¼š**
- ç§é’¥å¿…é¡»æ˜¯ 64 ä½åå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼ˆä¸å¸¦ `0x` å‰ç¼€ï¼‰
- è¯·ä½¿ç”¨æµ‹è¯•è´¦æˆ·çš„ç§é’¥ï¼Œä¸è¦ä½¿ç”¨ä¸»ç½‘è´¦æˆ·çš„ç§é’¥
- ç¡®ä¿æµ‹è¯•è´¦æˆ·æœ‰è¶³å¤Ÿçš„ Sepolia ETH ç”¨äºæ”¯ä»˜ Gas è´¹ç”¨

#### 4. å®‰å…¨æ³¨æ„äº‹é¡¹

âš ï¸ **é‡è¦å®‰å…¨æç¤ºï¼š**

1. **`.env` æ–‡ä»¶å·²æ·»åŠ åˆ° `.gitignore`**ï¼Œä¸ä¼šè¢«æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ
2. **è¯·å‹¿å°†åŒ…å«çœŸå®ç§é’¥çš„ `.env` æ–‡ä»¶æäº¤åˆ° Git**
3. **ä¸è¦å°† `.env` æ–‡ä»¶åˆ†äº«ç»™ä»–äººæˆ–ä¸Šä¼ åˆ°å…¬å…±ä»“åº“**
4. **å¦‚æœç§é’¥æ³„éœ²ï¼Œè¯·ç«‹å³è½¬ç§»èµ„é‡‘å¹¶æ›´æ¢è´¦æˆ·**
5. **å»ºè®®ä½¿ç”¨ä¸“é—¨çš„æµ‹è¯•è´¦æˆ·ï¼Œä¸è¦ä½¿ç”¨ä¸»è´¦æˆ·**

#### 5. éªŒè¯é…ç½®

é…ç½®å®Œæˆåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤éªŒè¯ï¼š

```bash
# ç¼–è¯‘åˆçº¦ï¼ˆéªŒè¯åŸºæœ¬é…ç½®ï¼‰
npm run compile

# æŸ¥çœ‹ç½‘ç»œé…ç½®ï¼ˆä¸ä¼šå®é™…è¿æ¥ï¼‰
npx hardhat node --help
```

å¦‚æœç¯å¢ƒå˜é‡é…ç½®æ­£ç¡®ï¼Œéƒ¨ç½²åˆ° Sepolia æ—¶å°†è‡ªåŠ¨ä½¿ç”¨ `.env` æ–‡ä»¶ä¸­çš„é…ç½®ã€‚

**æ³¨æ„**: 
- å¦‚æœä¸è®¾ç½® `SEPOLIA_RPC_URL`ï¼Œå°†ä½¿ç”¨é»˜è®¤çš„å…¬å…± RPC `https://rpc.sepolia.org`
- å¦‚æœä¸è®¾ç½® `PRIVATE_KEY`ï¼Œéƒ¨ç½²åˆ° Sepolia æ—¶å°†å¤±è´¥ï¼ˆéœ€è¦ç§é’¥ç­¾åäº¤æ˜“ï¼‰
- å¯¹äºæœ¬åœ°ç½‘ç»œï¼ˆhardhatã€localhostï¼‰ï¼Œä¸éœ€è¦é…ç½®ç¯å¢ƒå˜é‡

---

## éƒ¨ç½²æ­¥éª¤

### 1. å®‰è£…ä¾èµ–

```bash
npm install
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

**é‡è¦**: åœ¨éƒ¨ç½²åˆ° Sepolia æµ‹è¯•ç½‘ä¹‹å‰ï¼Œå¿…é¡»å…ˆé…ç½®ç¯å¢ƒå˜é‡ã€‚

1. å¤åˆ¶ç¯å¢ƒå˜é‡ç¤ºä¾‹æ–‡ä»¶ï¼š
   ```bash
   # Windows
   copy .env.example .env
   
   # Linux/Mac
   cp .env.example .env
   ```

2. ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œå¡«å…¥ä½ çš„å®é™…é…ç½®ï¼š
   - `SEPOLIA_RPC_URL`: ä½ çš„ Sepolia RPC ç«¯ç‚¹ï¼ˆå¯é€‰ï¼Œé»˜è®¤ä½¿ç”¨å…¬å…± RPCï¼‰
   - `PRIVATE_KEY`: ä½ çš„éƒ¨ç½²è´¦æˆ·ç§é’¥ï¼ˆå¿…éœ€ï¼Œä¸å¸¦ 0x å‰ç¼€ï¼‰

è¯¦ç»†é…ç½®è¯´æ˜è¯·å‚è€ƒ [ç¯å¢ƒå˜é‡é…ç½®](#ç¯å¢ƒå˜é‡é…ç½®) éƒ¨åˆ†ã€‚

### 3. ç¼–è¯‘åˆçº¦

```bash
npm run compile
```

### 4. éƒ¨ç½²åˆ° Sepolia æµ‹è¯•ç½‘

#### 4.1 éƒ¨ç½² MyNFT åˆçº¦

```bash
npm run deploy:mynft:sepolia
```

**è¾“å‡ºç¤ºä¾‹**:
```
Deploying MyNFT...
MyNFT deployed to: 0x1234...5678
```

#### 4.2 é“¸é€  NFT

```bash
npm run mint:sepolia
```

**è¯´æ˜**: 
- è„šæœ¬ä¼šè‡ªåŠ¨æŸ¥æ‰¾å·²éƒ¨ç½²çš„ MyNFT åˆçº¦
- é»˜è®¤é“¸é€ ä¸€ä¸ª NFT ç»™éƒ¨ç½²è€…è´¦æˆ·
- å¯ä»¥é€šè¿‡ä¿®æ”¹ `deploy/03-deploy-mynft-mint.js` è‡ªå®šä¹‰é“¸é€ å‚æ•°

#### 4.3 éƒ¨ç½² MyAuction åˆçº¦

```bash
npm run deploy:myauction:sepolia
```

**è¯´æ˜**:
- è„šæœ¬ä¼šè‡ªåŠ¨éƒ¨ç½²é€æ˜ä»£ç†åˆçº¦
- ä¼šè‡ªåŠ¨é…ç½® Chainlink ä»·æ ¼é¢„è¨€æœºï¼ˆSepolia æµ‹è¯•ç½‘ï¼‰
- éœ€è¦æŒ‡å®š `tokenId` å‚æ•°ï¼ˆé€šè¿‡ç¯å¢ƒå˜é‡æˆ–ä¿®æ”¹è„šæœ¬ï¼‰

**æŒ‡å®š tokenId**:
```bash
# Windows (CMD)
set TOKEN_ID=1 && npm run deploy:myauction:sepolia

# Windows (PowerShell)
$env:TOKEN_ID=1; npm run deploy:myauction:sepolia

# Linux/Mac
TOKEN_ID=1 npm run deploy:myauction:sepolia
```

**è¾“å‡ºç¤ºä¾‹**:
```
Deploying MyAuction...
Proxy deployed to: 0xabcd...ef01
Implementation deployed to: 0x9876...5432
ProxyAdmin deployed to: 0x1111...2222
```

#### 4.4 å‡çº§åˆ° MyAuctionV2

```bash
npm run upgrade:v2:sepolia
```

**è¯´æ˜**:
- è„šæœ¬ä¼šè‡ªåŠ¨æ£€æµ‹å·²éƒ¨ç½²çš„ä»£ç†åˆçº¦
- ä¼šéªŒè¯å‡çº§å…¼å®¹æ€§
- ä¼šè‡ªåŠ¨åˆå§‹åŒ– V2 åŠŸèƒ½

**è¾“å‡ºç¤ºä¾‹**:
```
Upgrading MyAuction contract to V2...
Proxy address: 0xabcd...ef01
Old implementation: 0x9876...5432
New implementation: 0x3333...4444
V2 features initialized
```

### 4. éƒ¨ç½²åˆ°æœ¬åœ°ç½‘ç»œ

#### 4.1 å¯åŠ¨æœ¬åœ°èŠ‚ç‚¹

```bash
npm run node
```

#### 4.2 éƒ¨ç½²åˆçº¦ï¼ˆæ–°ç»ˆç«¯ï¼‰

```bash
# éƒ¨ç½² MyNFT
npm run deploy:mynft:localhost

# é“¸é€  NFT
npm run mint:localhost

# éƒ¨ç½² MyAuction
npm run deploy:myauction:localhost

# å‡çº§åˆ° V2
npm run upgrade:v2:localhost
```

---

## æµ‹è¯•æ­¥éª¤

### 1. åŸºç¡€åŠŸèƒ½æµ‹è¯•

#### 1.1 æŸ¥çœ‹æ‹å–æ•°é‡

```bash
npx hardhat run test/get-auction-count-sepolia.js --network sepolia
```

#### 1.2 æŸ¥çœ‹æ‹å–è¯¦æƒ…

```bash
npx hardhat run test/get-auction-sepolia.js --network sepolia
```

**è¯´æ˜**: éœ€è¦ä¿®æ”¹è„šæœ¬ä¸­çš„ `auctionId` å‚æ•°

#### 1.3 å‡ºä»·æµ‹è¯•

```bash
# ä½¿ç”¨ ETH å‡ºä»·
npx hardhat run test/bid-sepolia.js --network sepolia

# éœ€è¦ä¿®æ”¹è„šæœ¬ä¸­çš„å‚æ•°ï¼š
# - auctionId: æ‹å– ID
# - amount: å‡ºä»·é‡‘é¢ï¼ˆETHï¼‰
# - tokenType: "ETH" æˆ– "USDC"
```

### 2. V2 åŠŸèƒ½æµ‹è¯•

#### 2.1 æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯

```bash
npm run test:v2:stats
```

#### 2.2 æµ‹è¯•å¹³å°æ‰‹ç»­è´¹

```bash
npm run test:v2:platform-fee
```

#### 2.3 è®¾ç½®åŠ¨æ€æ‰‹ç»­è´¹æ¡£æ¬¡

```bash
npm run test:v2:set-fee-tiers
```

**è¯´æ˜**: æ­¤è„šæœ¬ä¼šè®¾ç½®åŠ¨æ€æ‰‹ç»­è´¹æ¡£æ¬¡ï¼š
- $0 - $1,000: 5%
- $1,000 - $10,000: 3%
- $10,000 - $100,000: 1%
- $100,000+: 0.5%

#### 2.4 æµ‹è¯•åŠ¨æ€æ‰‹ç»­è´¹è®¡ç®—

```bash
npm run test:v2:dynamic-fee
```

#### 2.5 æµ‹è¯•æš‚åœåŠŸèƒ½

```bash
npm run test:v2:pause
```

#### 2.6 æµ‹è¯•æ‰¹é‡æŸ¥è¯¢

```bash
npm run test:v2:batch
```

---

## åˆçº¦å‡çº§

### å‡çº§æµç¨‹

1. **å‡†å¤‡å‡çº§åˆçº¦**: ç¡®ä¿æ–°åˆçº¦ç»§æ‰¿è‡ªæ—§åˆçº¦ï¼Œä¿æŒå­˜å‚¨å¸ƒå±€å…¼å®¹
2. **éªŒè¯å…¼å®¹æ€§**: è¿è¡Œ `upgrades.validateUpgrade()` éªŒè¯
3. **æ‰§è¡Œå‡çº§**: è¿è¡Œå‡çº§è„šæœ¬
4. **åˆå§‹åŒ–æ–°åŠŸèƒ½**: è°ƒç”¨æ–°ç‰ˆæœ¬çš„åˆå§‹åŒ–å‡½æ•°ï¼ˆå¦‚ `initializeV2()`ï¼‰
5. **éªŒè¯åŠŸèƒ½**: è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯æ–°åŠŸèƒ½

### å‡çº§æ³¨æ„äº‹é¡¹

- âš ï¸ **å­˜å‚¨å¸ƒå±€**: æ–°å˜é‡åªèƒ½æ·»åŠ åœ¨ç°æœ‰å˜é‡ä¹‹å
- âš ï¸ **åˆå§‹åŒ–**: ä½¿ç”¨ `reinitializer` è€Œä¸æ˜¯ `initializer`
- âš ï¸ **å­—èŠ‚ç ä¼˜åŒ–**: ç¼–è¯‘å™¨ä¼˜åŒ–å¯èƒ½å¯¼è‡´ç›¸åŒå­—èŠ‚ç ï¼ŒOpenZeppelin ä¼šé‡ç”¨å®ç°åœ°å€

### å‡çº§è„šæœ¬

```bash
# Sepolia æµ‹è¯•ç½‘
npm run upgrade:v2:sepolia

# æœ¬åœ°ç½‘ç»œ
npm run upgrade:v2:localhost
```

---

## ä½¿ç”¨è¯´æ˜

### åˆ›å»ºæ‹å–

1. ç¡®ä¿ä½ æ‹¥æœ‰è¦æ‹å–çš„ NFT
2. æˆæƒ MyAuction åˆçº¦è½¬ç§»ä½ çš„ NFT
3. è°ƒç”¨ `createAuction()` å‡½æ•°

**å‚æ•°**:
- `_nftAddress`: NFT åˆçº¦åœ°å€
- `_tokenId`: NFT token ID
- `_startPrice`: èµ·å§‹ä»·æ ¼ï¼ˆUSD ä»·å€¼ï¼Œ8ä½å°æ•°ï¼‰
- `_startTime`: å¼€å§‹æ—¶é—´ï¼ˆUnix æ—¶é—´æˆ³ï¼‰
- `_endTime`: ç»“æŸæ—¶é—´ï¼ˆUnix æ—¶é—´æˆ³ï¼‰

### å‡ºä»·

1. å¦‚æœä½¿ç”¨ ERC20 ä»£å¸ï¼Œå…ˆæˆæƒ MyAuction åˆçº¦ä½¿ç”¨ä½ çš„ä»£å¸
2. è°ƒç”¨ `bid()` å‡½æ•°

**å‚æ•°**:
- `_auctionId`: æ‹å– ID
- `_amount`: å‡ºä»·é‡‘é¢ï¼ˆåŸå§‹ä»£å¸æ•°é‡ï¼‰
- `_token`: ä»£å¸åœ°å€ï¼ˆ`address(0)` è¡¨ç¤º ETHï¼‰

**æ³¨æ„**: 
- å‡ºä»·å¿…é¡»é«˜äºå½“å‰æœ€é«˜å‡ºä»·çš„ USD ä»·å€¼
- ETH å‡ºä»·éœ€è¦å‘é€ `msg.value`
- ERC20 å‡ºä»·éœ€è¦å…ˆæˆæƒ

### ç»“æŸæ‹å–

è°ƒç”¨ `endAuctionAndClaimNFT()` å‡½æ•°ï¼š

- æ‹å–ç»“æŸåè‡ªåŠ¨æ‰§è¡Œ
- NFT è½¬ç§»ç»™æœ€é«˜å‡ºä»·è€…
- èµ„é‡‘è½¬ç§»ç»™å–å®¶ï¼ˆæ‰£é™¤æ‰‹ç»­è´¹ï¼‰
- æ‰‹ç»­è´¹è½¬ç§»ç»™åˆçº¦æ‰€æœ‰è€…

### é…ç½®ä»·æ ¼é¢„è¨€æœº

åˆçº¦æ‰€æœ‰è€…å¯ä»¥é…ç½®ä»£å¸çš„ä»·æ ¼é¢„è¨€æœºï¼š

```solidity
// è®¾ç½®å•ä¸ªä»·æ ¼é¢„è¨€æœº
setPriceFeed(tokenAddress, priceFeedAddress);

// æ‰¹é‡è®¾ç½®ä»·æ ¼é¢„è¨€æœº
setPriceFeeds(tokenAddresses[], priceFeedAddresses[]);
```

### é…ç½®æ‰‹ç»­è´¹ (V2)

#### è®¾ç½®å›ºå®šæ‰‹ç»­è´¹

```solidity
setPlatformFee(500); // 5% (500 åŸºç‚¹)
```

#### è®¾ç½®åŠ¨æ€æ‰‹ç»­è´¹æ¡£æ¬¡

```solidity
uint256[] memory thresholds = [
    1000e8,    // $1,000
    10000e8,   // $10,000
    100000e8   // $100,000
];

uint256[] memory feeRates = [
    500,  // 5% for < $1,000
    300,  // 3% for >= $1,000
    100,  // 1% for >= $10,000
    50    // 0.5% for >= $100,000
];

setFeeTiers(thresholds, feeRates);
```

---

## å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•è·å–å·²éƒ¨ç½²çš„åˆçº¦åœ°å€ï¼Ÿ

éƒ¨ç½²ä¿¡æ¯ä¿å­˜åœ¨ `deployments/<network>/` ç›®å½•ä¸‹ï¼Œä¾‹å¦‚ï¼š
- `deployments/sepolia/MyNFT.json`
- `deployments/sepolia/MyAuction.json`

### Q2: å¦‚ä½•æŸ¥çœ‹ä»£ç†åˆçº¦çš„å®ç°åœ°å€ï¼Ÿ

```bash
npx hardhat run scripts/check-bytecode-diff.js --network sepolia
```

æˆ–ä½¿ç”¨ Ethers.js:

```javascript
const implementationAddress = await upgrades.erc1967.getImplementationAddress(proxyAddress);
```

### Q3: ä¸ºä»€ä¹ˆå‡çº§åå®ç°åœ°å€æ²¡æœ‰æ”¹å˜ï¼Ÿ

OpenZeppelin ä¼šæ£€æµ‹å­—èŠ‚ç æ˜¯å¦ç›¸åŒï¼Œå¦‚æœç›¸åŒä¼šé‡ç”¨å®ç°åœ°å€ã€‚è¿™æ˜¯æ­£å¸¸çš„ä¼˜åŒ–è¡Œä¸ºã€‚

### Q4: å¦‚ä½•æµ‹è¯•å‡ºä»·åŠŸèƒ½ï¼Ÿ

1. ç¡®ä¿æ‹å–å·²åˆ›å»ºä¸”å¤„äºæ´»è·ƒçŠ¶æ€
2. ç¡®ä¿ä»·æ ¼é¢„è¨€æœºå·²é…ç½®
3. ä½¿ç”¨æµ‹è¯•è„šæœ¬æˆ–ç›´æ¥è°ƒç”¨åˆçº¦å‡½æ•°

### Q5: æ‰‹ç»­è´¹æ˜¯å¦‚ä½•è®¡ç®—çš„ï¼Ÿ

- **å›ºå®šæ‰‹ç»­è´¹**: `æ‰‹ç»­è´¹ = å‡ºä»·é‡‘é¢ Ã— platformFee / 10000`
- **åŠ¨æ€æ‰‹ç»­è´¹**: æ ¹æ®æ‹å–é‡‘é¢çš„ USD ä»·å€¼æŸ¥æ‰¾å¯¹åº”çš„è´¹ç‡æ¡£æ¬¡

### Q6: å¦‚ä½•æš‚åœåˆçº¦ï¼Ÿ

åˆçº¦æ‰€æœ‰è€…è°ƒç”¨ `pause()` å‡½æ•°ã€‚æš‚åœåï¼Œæ‰€æœ‰æ“ä½œï¼ˆåˆ›å»ºæ‹å–ã€å‡ºä»·ã€ç»“æŸæ‹å–ï¼‰éƒ½ä¼šè¢«é˜»æ­¢ã€‚

### Q7: Chainlink ä»·æ ¼é¢„è¨€æœºåœ°å€åœ¨å“ªé‡Œï¼Ÿ

Sepolia æµ‹è¯•ç½‘çš„ Chainlink ä»·æ ¼é¢„è¨€æœºåœ°å€ï¼š
- ETH/USD: `0x694AA1769357215DE4FAC081bf1f309aDC325306`
- USDC/USD: `0xA2F78ab2355fe2f984D808B5CeE7FD0A93D5270E`

æ›´å¤šåœ°å€è¯·å‚è€ƒ [Chainlink æ–‡æ¡£](https://docs.chain.link/data-feeds/price-feeds/addresses)ã€‚

---

## é¡¹ç›®ç»“æ„

```
my-auction/
â”œâ”€â”€ contracts/              # æ™ºèƒ½åˆçº¦
â”‚   â”œâ”€â”€ MyNFT.sol          # NFT åˆçº¦
â”‚   â”œâ”€â”€ MyAuction.sol       # æ‹å–åˆçº¦ V1
â”‚   â””â”€â”€ MyAuctionV2.sol    # æ‹å–åˆçº¦ V2
â”œâ”€â”€ deploy/                 # éƒ¨ç½²è„šæœ¬
â”‚   â”œâ”€â”€ 02-deploy-mynft.js
â”‚   â”œâ”€â”€ 03-deploy-mynft-mint.js
â”‚   â”œâ”€â”€ 04-deploy-myauction.js
â”‚   â””â”€â”€ 05-upgrade-myauction-v2.js
â”œâ”€â”€ test/                   # æµ‹è¯•è„šæœ¬
â”‚   â”œâ”€â”€ bid-sepolia.js
â”‚   â”œâ”€â”€ get-auction-sepolia.js
â”‚   â”œâ”€â”€ get-auction-count-sepolia.js
â”‚   â””â”€â”€ test-v2-*.js       # V2 åŠŸèƒ½æµ‹è¯•
â”œâ”€â”€ deployments/            # éƒ¨ç½²è®°å½•
â”‚   â”œâ”€â”€ localhost/
â”‚   â””â”€â”€ sepolia/
â”œâ”€â”€ hardhat.config.js       # Hardhat é…ç½®
â”œâ”€â”€ package.json            # é¡¹ç›®é…ç½®
â”œâ”€â”€ README.md               # é¡¹ç›®è¯´æ˜
â””â”€â”€ docs/                   # é¡¹ç›®æ–‡æ¡£ç›®å½•
    â”œâ”€â”€ PROJECT_SUMMARY.md  # é¡¹ç›®æ€»ç»“æŠ¥å‘Š
    â”œâ”€â”€ TEST_REPORT.md      # æµ‹è¯•æŠ¥å‘Š
    â”œâ”€â”€ TEST_SUMMARY.md     # æµ‹è¯•æ€»ç»“
    â”œâ”€â”€ DEPLOYMENT.md       # æœ¬æ–‡æ¡£
    â”œâ”€â”€ DEPLOYMENT_SEPOLIA.md # Sepolia éƒ¨ç½²æ–‡æ¡£
    â”œâ”€â”€ UPGRADE_ANALYSIS.md # å‡çº§åˆ†ææ–‡æ¡£
    â””â”€â”€ images/             # æ–‡æ¡£å›¾ç‰‡
```

---

## ç›¸å…³é“¾æ¥

- [Hardhat æ–‡æ¡£](https://hardhat.org/docs)
- [OpenZeppelin æ–‡æ¡£](https://docs.openzeppelin.com/)
- [Chainlink æ–‡æ¡£](https://docs.chain.link/)
- [Sepolia æµ‹è¯•ç½‘](https://sepolia.dev/)

---

## è®¸å¯è¯

MIT License

---

**æœ€åæ›´æ–°**: 2024å¹´

